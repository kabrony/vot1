{% extends "base_cyberpunk.html" %}

{% block title %}VOT1 Cyberpunk Dashboard{% endblock %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard-stats.css') }}">
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.1/dist/chart.min.js"></script>
{% endblock %}

{% block content %}
<div class="dashboard-grid">
    <!-- System Overview Card -->
    <div class="cyberpunk-card card-primary">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">System Overview</h3>
            <button class="cyberpunk-btn btn-secondary btn-sm refresh-card" data-target="system-overview">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
        <div class="system-stats-grid">
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-microchip"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="total-memory-count">0</span>
                    <span class="stat-label">Total Memories</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-project-diagram"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="connection-count">0</span>
                    <span class="stat-label">Neural Connections</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-brain"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="storage-used">0MB</span>
                    <span class="stat-label">Storage Used</span>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-icon"><i class="fas fa-tachometer-alt"></i></div>
                <div class="stat-info">
                    <span class="stat-value" id="system-performance">100%</span>
                    <span class="stat-label">System Performance</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Memory Activity Card -->
    <div class="cyberpunk-card card-secondary">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">Memory Activity</h3>
            <div class="card-actions">
                <select id="time-range-select" class="cyberpunk-select time-range-select">
                    <option value="day">Last 24 Hours</option>
                    <option value="week">Last 7 Days</option>
                    <option value="month">Last 30 Days</option>
                </select>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="memory-activity-chart"></canvas>
        </div>
    </div>
    
    <!-- Recent Memories Card -->
    <div class="cyberpunk-card card-tertiary">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">Recent Memories</h3>
            <div class="card-actions">
                <select id="memory-type-filter" class="cyberpunk-select memory-type-filter">
                    <option value="all">All Types</option>
                    <option value="conversation">Conversation</option>
                    <option value="fact">Fact</option>
                    <option value="concept">Concept</option>
                </select>
            </div>
        </div>
        <div class="memory-list" id="recent-memories-list">
            <div class="loading-spinner">
                <div class="spinner"></div>
                <span>Loading memories...</span>
            </div>
            <!-- Memories will be inserted here -->
        </div>
    </div>
    
    <!-- System Telemetry Card -->
    <div class="cyberpunk-card">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">System Telemetry</h3>
            <button class="cyberpunk-btn btn-secondary btn-sm refresh-card" data-target="system-telemetry">
                <i class="fas fa-sync-alt"></i>
            </button>
        </div>
        <div class="telemetry-grid">
            <div class="telemetry-item">
                <div class="telemetry-label">CPU Usage</div>
                <div class="cyberpunk-progress-bar">
                    <div class="cyberpunk-progress-fill" id="cpu-usage-fill" style="width: 45%;"></div>
                    <div class="cyberpunk-progress-value" id="cpu-usage-value">45%</div>
                </div>
            </div>
            <div class="telemetry-item">
                <div class="telemetry-label">Memory Usage</div>
                <div class="cyberpunk-progress-bar">
                    <div class="cyberpunk-progress-fill" id="memory-usage-fill" style="width: 62%;" data-color="secondary"></div>
                    <div class="cyberpunk-progress-value" id="memory-usage-value">62%</div>
                </div>
            </div>
            <div class="telemetry-item">
                <div class="telemetry-label">Storage Usage</div>
                <div class="cyberpunk-progress-bar">
                    <div class="cyberpunk-progress-fill" id="storage-usage-fill" style="width: 28%;" data-color="tertiary"></div>
                    <div class="cyberpunk-progress-value" id="storage-usage-value">28%</div>
                </div>
            </div>
            <div class="telemetry-item">
                <div class="telemetry-label">Network Activity</div>
                <div class="cyberpunk-progress-bar">
                    <div class="cyberpunk-progress-fill" id="network-activity-fill" style="width: 76%;"></div>
                    <div class="cyberpunk-progress-value" id="network-activity-value">76%</div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- AI Integration Status Card -->
    <div class="cyberpunk-card">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">AI Integration Status</h3>
        </div>
        <div class="integration-status-list">
            <div class="integration-item">
                <div class="integration-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="integration-info">
                    <div class="integration-name">Claude 3.7 Sonnet</div>
                    <div class="integration-status" data-status="online">
                        <span class="status-indicator"></span>
                        <span class="status-text">Online</span>
                    </div>
                </div>
                <div class="integration-actions">
                    <button class="cyberpunk-btn btn-sm">Configure</button>
                </div>
            </div>
            <div class="integration-item">
                <div class="integration-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div class="integration-info">
                    <div class="integration-name">Perplexity AI</div>
                    <div class="integration-status" data-status="online">
                        <span class="status-indicator"></span>
                        <span class="status-text">Online</span>
                    </div>
                </div>
                <div class="integration-actions">
                    <button class="cyberpunk-btn btn-sm">Configure</button>
                </div>
            </div>
            <div class="integration-item">
                <div class="integration-icon">
                    <i class="fas fa-network-wired"></i>
                </div>
                <div class="integration-info">
                    <div class="integration-name">MCP Hybrid Automation</div>
                    <div class="integration-status" data-status="online">
                        <span class="status-indicator"></span>
                        <span class="status-text">Online</span>
                    </div>
                </div>
                <div class="integration-actions">
                    <button class="cyberpunk-btn btn-sm">Configure</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Quick Actions Card -->
    <div class="cyberpunk-card">
        <div class="cyberpunk-card-header">
            <h3 class="cyberpunk-card-title">Quick Actions</h3>
        </div>
        <div class="quick-actions-grid">
            <button class="quick-action-btn" id="new-chat-btn">
                <i class="fas fa-comment-alt"></i>
                <span>New AI Chat</span>
            </button>
            <button class="quick-action-btn" id="search-memories-btn">
                <i class="fas fa-search"></i>
                <span>Search Memories</span>
            </button>
            <button class="quick-action-btn" id="run-analysis-btn">
                <i class="fas fa-chart-line"></i>
                <span>Run Analysis</span>
            </button>
            <button class="quick-action-btn" id="backup-system-btn">
                <i class="fas fa-hdd"></i>
                <span>Backup System</span>
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize charts
    initMemoryActivityChart();
    
    // Simulate loading recent memories
    simulateLoadingMemories();
    
    // Add event listeners
    document.getElementById('new-chat-btn').addEventListener('click', function() {
        window.location.href = "{{ url_for('dashboard.cyberpunk_chat') }}";
    });
    
    // Setup refresh buttons
    document.querySelectorAll('.refresh-card').forEach(button => {
        button.addEventListener('click', function() {
            const target = this.getAttribute('data-target');
            refreshCard(target);
        });
    });
});

// Initialize Memory Activity Chart
function initMemoryActivityChart() {
    const ctx = document.getElementById('memory-activity-chart').getContext('2d');
    
    // Generate sample data
    const labels = [];
    const data1 = [];
    const data2 = [];
    
    for (let i = 0; i < 24; i++) {
        labels.push(`${i}:00`);
        data1.push(Math.floor(Math.random() * 50) + 10);
        data2.push(Math.floor(Math.random() * 30) + 5);
    }
    
    const memoryActivityChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'New Memories',
                    data: data1,
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--cyberpunk-primary').trim(),
                    backgroundColor: 'rgba(255, 42, 109, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Memory Access',
                    data: data2,
                    borderColor: getComputedStyle(document.documentElement).getPropertyValue('--cyberpunk-secondary').trim(),
                    backgroundColor: 'rgba(5, 217, 232, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--cyberpunk-text-primary').trim(),
                        font: {
                            family: getComputedStyle(document.documentElement).getPropertyValue('--font-main').trim()
                        }
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.05)'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--cyberpunk-text-secondary').trim()
                    }
                },
                y: {
                    grid: {
                        color: 'rgba(255, 255, 255, 0.05)'
                    },
                    ticks: {
                        color: getComputedStyle(document.documentElement).getPropertyValue('--cyberpunk-text-secondary').trim()
                    }
                }
            }
        }
    });
    
    // Update chart when time range changes
    document.getElementById('time-range-select').addEventListener('change', function() {
        // In a real app, we would fetch new data based on the selected time range
        // For now, we'll just simulate different data
        
        const newLabels = [];
        const newData1 = [];
        const newData2 = [];
        
        const range = this.value;
        let pointCount = 24;
        
        if (range === 'week') {
            pointCount = 7;
            for (let i = 0; i < pointCount; i++) {
                const day = new Date();
                day.setDate(day.getDate() - (pointCount - i - 1));
                newLabels.push(day.toLocaleDateString('en-US', { weekday: 'short' }));
            }
        } else if (range === 'month') {
            pointCount = 30;
            for (let i = 0; i < pointCount; i++) {
                const day = new Date();
                day.setDate(day.getDate() - (pointCount - i - 1));
                newLabels.push(day.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }));
            }
        } else {
            // Day (24 hours)
            for (let i = 0; i < 24; i++) {
                newLabels.push(`${i}:00`);
            }
        }
        
        for (let i = 0; i < pointCount; i++) {
            newData1.push(Math.floor(Math.random() * 50) + 10);
            newData2.push(Math.floor(Math.random() * 30) + 5);
        }
        
        memoryActivityChart.data.labels = newLabels;
        memoryActivityChart.data.datasets[0].data = newData1;
        memoryActivityChart.data.datasets[1].data = newData2;
        memoryActivityChart.update();
    });
}

// Simulate loading recent memories
function simulateLoadingMemories() {
    setTimeout(() => {
        const memoryContainer = document.getElementById('recent-memories-list');
        memoryContainer.innerHTML = ''; // Clear loading spinner
        
        const memoryTypes = ['conversation', 'fact', 'concept'];
        const memoryIcons = {
            'conversation': 'comment-alt',
            'fact': 'info-circle',
            'concept': 'lightbulb'
        };
        
        // Generate 5 sample memories
        for (let i = 1; i <= 5; i++) {
            const type = memoryTypes[Math.floor(Math.random() * memoryTypes.length)];
            const time = new Date();
            time.setMinutes(time.getMinutes() - (i * 10));
            
            const memoryItem = document.createElement('div');
            memoryItem.className = `memory-item memory-${type}`;
            
            memoryItem.innerHTML = `
                <div class="memory-icon">
                    <i class="fas fa-${memoryIcons[type]}"></i>
                </div>
                <div class="memory-content">
                    <div class="memory-title">Sample Memory ${i}</div>
                    <div class="memory-details">
                        <span class="memory-type">${type.charAt(0).toUpperCase() + type.slice(1)}</span>
                        <span class="memory-time">${time.toLocaleTimeString()}</span>
                    </div>
                    <div class="memory-summary">This is a sample memory entry to demonstrate the cyberpunk dashboard interface.</div>
                </div>
            `;
            
            memoryContainer.appendChild(memoryItem);
        }
        
        // Add memory filter functionality
        document.getElementById('memory-type-filter').addEventListener('change', function() {
            const selectedType = this.value;
            const memoryItems = document.querySelectorAll('.memory-item');
            
            memoryItems.forEach(item => {
                if (selectedType === 'all' || item.classList.contains(`memory-${selectedType}`)) {
                    item.style.display = 'flex';
                } else {
                    item.style.display = 'none';
                }
            });
        });
        
    }, 1500);
}

// Refresh card data
function refreshCard(target) {
    // In a real app, we would fetch fresh data from the server
    // For now, we'll just simulate refreshing
    
    // Show notification
    window.CyberpunkUI.showNotification(`Refreshing ${target.replace('-', ' ')} data...`, 'info');
    
    if (target === 'system-overview') {
        // Simulate updating system overview stats
        simulateSystemStats();
    } else if (target === 'system-telemetry') {
        // Simulate updating telemetry
        simulateTelemetry();
    }
}

// Simulate system stats
function simulateSystemStats() {
    const memoryCount = Math.floor(Math.random() * 5000) + 1000;
    const connectionCount = Math.floor(Math.random() * 10000) + 5000;
    const storageUsed = (Math.random() * 100 + 50).toFixed(1);
    const systemPerformance = (Math.random() * 20 + 80).toFixed(0);
    
    // Animate the number counting up
    animateCounter('total-memory-count', memoryCount);
    animateCounter('connection-count', connectionCount);
    document.getElementById('storage-used').textContent = `${storageUsed}MB`;
    document.getElementById('system-performance').textContent = `${systemPerformance}%`;
}

// Simulate telemetry
function simulateTelemetry() {
    updateProgressBar('cpu-usage', Math.floor(Math.random() * 60) + 20);
    updateProgressBar('memory-usage', Math.floor(Math.random() * 40) + 40, 'secondary');
    updateProgressBar('storage-usage', Math.floor(Math.random() * 30) + 10, 'tertiary');
    updateProgressBar('network-activity', Math.floor(Math.random() * 50) + 30);
}

// Update progress bar
function updateProgressBar(id, value, color = 'primary') {
    const fill = document.getElementById(`${id}-fill`);
    const valueEl = document.getElementById(`${id}-value`);
    
    // Get color variable
    let colorVar = `--cyberpunk-primary`;
    if (color === 'secondary') colorVar = `--cyberpunk-secondary`;
    if (color === 'tertiary') colorVar = `--cyberpunk-tertiary`;
    
    // Set fill color
    fill.style.backgroundColor = `var(${colorVar})`;
    
    // Animate width change
    let currentWidth = parseInt(fill.style.width);
    const targetWidth = value;
    
    const animateWidth = () => {
        if (currentWidth < targetWidth) {
            currentWidth += 1;
        } else if (currentWidth > targetWidth) {
            currentWidth -= 1;
        } else {
            clearInterval(animation);
            return;
        }
        
        fill.style.width = `${currentWidth}%`;
        valueEl.textContent = `${currentWidth}%`;
    };
    
    const animation = setInterval(animateWidth, 10);
}

// Animate counter
function animateCounter(id, targetValue) {
    const element = document.getElementById(id);
    const startValue = parseInt(element.textContent) || 0;
    const duration = 1000; // 1 second
    const stepTime = 20;
    const steps = duration / stepTime;
    const increment = (targetValue - startValue) / steps;
    
    let currentValue = startValue;
    const counter = setInterval(() => {
        currentValue += increment;
        if ((increment > 0 && currentValue >= targetValue) || 
            (increment < 0 && currentValue <= targetValue)) {
            clearInterval(counter);
            currentValue = targetValue;
        }
        element.textContent = Math.floor(currentValue).toLocaleString();
    }, stepTime);
}

// Initialize on page load
simulateSystemStats();
simulateTelemetry();
</script>
{% endblock %} 