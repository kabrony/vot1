{% extends "base.html" %}

{% block title %}VOTai Dashboard{% endblock %}

{% block content %}
<div class="row">
    <!-- System Status Cards -->
    <div class="col-md-12 mb-4">
        <h4>System Status</h4>
        <div class="row">
            <!-- Memory Status Card -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        Memory System
                    </div>
                    <div class="card-body">
                        {% if memory_status.status == "active" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-active me-2"></span>
                            <strong>Active</strong>
                        </div>
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>Activities:</span>
                                <span>{{ memory_status.activity_count }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Tasks:</span>
                                <span>{{ memory_status.tasks_count }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Knowledge:</span>
                                <span>{{ memory_status.knowledge_count }}</span>
                            </div>
                        </div>
                        {% elif memory_status.status == "inactive" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-inactive me-2"></span>
                            <strong>Inactive</strong>
                        </div>
                        {% elif memory_status.status == "error" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-error me-2"></span>
                            <strong>Error</strong>
                        </div>
                        <div class="mt-2 text-danger">{{ memory_status.error }}</div>
                        {% else %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-unknown me-2"></span>
                            <strong>Unknown</strong>
                        </div>
                        {% endif %}
                        <div class="mt-3">
                            <a href="/memory" class="btn btn-sm btn-outline-primary w-100">
                                <i class="bi bi-database"></i> Manage Memory
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GitHub Status Card -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        GitHub Integration
                    </div>
                    <div class="card-body">
                        {% if github_status.status == "active" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-active me-2"></span>
                            <strong>Active</strong>
                        </div>
                        <div class="mt-2 small">{{ github_status.connection_url }}</div>
                        
                        {% if github_status.repo_status %}
                        <div class="mt-3">
                            <strong>Repository:</strong> {{ github_status.repo_status.name }}
                            <div class="d-flex justify-content-between">
                                <span>Open Issues:</span>
                                <span>{{ github_status.repo_status.open_issues_count }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Last Updated:</span>
                                <span class="small">{{ github_status.repo_status.updated_at }}</span>
                            </div>
                        </div>
                        {% endif %}
                        
                        {% elif github_status.status == "inactive" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-inactive me-2"></span>
                            <strong>Inactive</strong>
                        </div>
                        <div class="mt-2 small">Connection not established</div>
                        {% elif github_status.status == "error" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-error me-2"></span>
                            <strong>Error</strong>
                        </div>
                        <div class="mt-2 text-danger">{{ github_status.error }}</div>
                        {% else %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-unknown me-2"></span>
                            <strong>Unknown</strong>
                        </div>
                        {% endif %}
                        <div class="mt-3">
                            <a href="/github" class="btn btn-sm btn-outline-primary w-100">
                                <i class="bi bi-github"></i> Manage GitHub
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bridge Status Card -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        MCP Bridge
                    </div>
                    <div class="card-body">
                        {% if bridge_status.status == "active" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-active me-2"></span>
                            <strong>Active</strong>
                        </div>
                        {% if bridge_status.metrics %}
                        <div class="mt-3">
                            <div class="d-flex justify-content-between">
                                <span>Requests:</span>
                                <span>{{ bridge_status.metrics.metrics.requests_processed }}</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Avg Time:</span>
                                <span>{{ bridge_status.metrics.metrics.average_request_time|round(2) }} sec</span>
                            </div>
                            <div class="d-flex justify-content-between">
                                <span>Uptime:</span>
                                <span>{{ bridge_status.metrics.metrics.uptime }}</span>
                            </div>
                        </div>
                        {% endif %}
                        {% elif bridge_status.status == "inactive" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-inactive me-2"></span>
                            <strong>Inactive</strong>
                        </div>
                        {% elif bridge_status.status == "error" %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-error me-2"></span>
                            <strong>Error</strong>
                        </div>
                        <div class="mt-2 text-danger">{{ bridge_status.error }}</div>
                        {% else %}
                        <div class="d-flex align-items-center">
                            <span class="status-indicator status-unknown me-2"></span>
                            <strong>Unknown</strong>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Agents Overview -->
    <div class="col-md-12">
        <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span>Agent Overview</span>
                <a href="/agents" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-person-workspace"></i> Manage Agents
                </a>
            </div>
            <div class="card-body">
                {% if agents|length > 0 %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Agent ID</th>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Last Activity</th>
                                <th>Source</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for agent in agents %}
                            <tr>
                                <td>{{ agent.id }}</td>
                                <td>{{ agent.name }}</td>
                                <td>
                                    <span class="status-indicator 
                                        {% if agent.status == 'active' %}status-active
                                        {% elif agent.status == 'inactive' %}status-inactive
                                        {% elif agent.status == 'error' %}status-error
                                        {% else %}status-unknown{% endif %}"></span>
                                    {{ agent.status }}
                                </td>
                                <td>{{ agent.last_activity }}</td>
                                <td>{{ agent.source }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i> No agents are currently registered in the system
                </div>
                <p>
                    Once agents are registered with the VOTai ecosystem, they will appear here.
                </p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block script %}
// Dashboard home page script
{% endblock %} 